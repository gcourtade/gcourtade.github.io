
var local = window.location;  
var contextPath = local.pathname.split("/")[1];
var messageTimer=null; 

 
var basePath = local.protocol+"//"+local.host+"/"+contextPath;
var local_host="http://"+local.host+"/";

 
var ajaxArg={
	url : "",   
	data : {},   
	extraDate : null,  
	returnFun:""  
};
/**
 * ajax  
 */
function ajaxPost(ajaxArg){
	$.ajax({
		type:'post',
		url:ajaxArg.url,
		data:ajaxArg.data,
		dataType:'json',
		success:function(data){
			ajaxArg.returnFun(data,ajaxArg.extraDate);
		},
		error: function(XMLHttpRequest, textStatus, errorThrown) {
			console.info("----- submit search error ---");
			console.info("----- XMLHttpRequest.responseText ---"+XMLHttpRequest.responseText);
			console.info("----- XMLHttpRequest.status ---"+XMLHttpRequest.status);
			console.info("----- XMLHttpRequest.readyState ---"+XMLHttpRequest.readyState);
			console.info("----- textStatus ---"+textStatus);
		}
	})
};
$(function(){
 
	$(".require_sub").subTextMax({trim:false});
 
	$(".require_sub_add_title").subTextMax({trim:false,add_title:true});
	 
	$(".search-article-abstract").subTextMax({trim:false,keep_len:300,add_title:false,content_type:'html'});
	
 
	var currentPageView = $("#pageViewId").length > 0 ? $("#pageViewId").val():"";
	if(currentPageView != "首页") {
		$(".second-level-code").show();
	}
	if(typeof(advSetting) != "undefined"){
		getCommonAd(advSetting);
	} 

 
	refreshAfterAjaxLoad();
 
	if($(".accessCount").length>0){
		accessCount();
	}
	if($("#newsId").length>0){
		addNewsRecords();
	}
 
	loadArticleCitedByIds();
})

/**
 *  
 * @param setting
 * @return
 */
function getCommonAd(setting){
	if(setting != undefined){
		var ajaxArg={
			url : local_host +"common/adv",   										 
			data : {'columnName':setting.columnName,'size':setting.size},  			 
			returnFun:setting.callback 												 
		};
		ajaxPost(ajaxArg);
	}
}
/**
 *  
 * @return
 */
function loadArticleMetricByIds(){
	var idArray = [] ;
	$(".article-list").each(function(i,e){
		var articleId = $(e).attr("id");
		if(!isNull(articleId)){
			idArray.push(articleId);
		}
	})
	if(idArray.length > 0){
		var ids = idArray.toString();
		var ajaxArg={
			url: local_host +"article/getArticleMetric",   										
			data: {'articleIds':ids},
			returnFun:outArticleMetric 																		
		};
		ajaxPost(ajaxArg);
	}
}

/**
 *  
 * @param data
 * @param indexArray
 * @return
 */
function outArticleMetric(data){
	if(typeof(data) != "undefined"){
		$.each(data,function(i,e){
			$("#"+e.articleId).find(".abs-num").text(e.viewCount);
			$("#"+e.articleId).find(".html-num").text(e.htmlViewCount);
			$("#"+e.articleId).find(".pdf-num").text(e.pdfDownCount);
		})
	}
}

 
function refreshAfterAjaxLoad(){
	 
	$(".require_sub").subTextMax({trim:false});
	//TOP
	$("#title a").each(function(index){
        $(this).mouseover(function(){
          $("#title .titsh").removeClass("titsh");
          $("#content .consh").removeClass("consh");
          $(this).addClass("titsh");
          $("#content>div:eq("+index+")").addClass("consh");
        })
	})
 
	loadArticleMetricByIds();
 
	loadArticleReleaseInfoByIds();
 
	$(".require_sub").subTextMax({trim:false})
 
	$(".bottom-backTop").click(function(){
        $("html,body").animate({scrollTop:0},500);
    })
 
    $(".group2").colorbox({rel:'group2',width:'90%',height:"75%",opacity:'0.8'});
}


/**
 *  
 * @return
 */
function loadArticleReleaseInfoByIds(){
	var idArray = [] ;
	$(".article-list-latest").each(function(i,e){
		var articleId = $(e).attr("id");
		if(!isNull(articleId)){
			idArray.push(articleId);
		}
	})
	
	if(idArray.length > 0){
		var ids = idArray.toString();
		var ajaxArg={
			url: local_host +"article/getArticleReleaseProgress",
			data: {'articleIds':ids},
			returnFun:outArticleReleaseInfo
		};
		ajaxPost(ajaxArg);
	}
}

/**
 *  
 * @param data
 * @param indexArray
 * @return
 */
function outArticleReleaseInfo(data){
	if(typeof(data) != "undefined" && data != null){
		$.each(data,function(i,e){
			$("#"+e.articleId).find(".current_state").html(e.currentState);
			$("#"+e.articleId).find(".current_state_en").html(e.currentStateEn);
			$("#"+e.articleId).find(".latest_update").html(e.lastReleaseTime);
			$("#"+e.articleId).find(".latest_update_span").show();
		})
	}
}
/**
 *  
 * @return
 */
function accessCount(){
	$.ajax({
		type:'post',
		url:local_host+"tongji/getBaiDuTongJi",
		data:"",
		dataType:'json',
		success:function(res){
    		var jsonObj = jQuery.parseJSON(res);
    		var json = jsonObj.body.data[0].result.items;
    		if(json != undefined && json != "" ){
	    		
	    		var resFilds = jsonObj.body.data[0].result.fields;
	    		var fild = "";
	    		var ipArea = "";
	    		var result = "";
	    		for(var i = 0;i< resFilds.length;i++){
					 if(resFilds[i] == "visitor_count"){
						 fild = i-1;
					 }
				}
	    		for(var i = 0;i< json.length;i++){
	    			var jValue=json[i];
	    				if(i == 0){
	    					for(var j = 0;j< jValue.length;j++){
		    					if(local_host.indexOf(jValue[j][0].name)>0){
		    						ipArea = j;
		    					}
	    					}
	    				}else{
	    					for(var j = 0;j< jValue.length;j++){
	    						var jcount = jValue[j];
	    						if(ipArea == j){
			    					result = jcount[fild];
	    						}
		    				}
	    					jValue[ipArea];
	    				}
	    		}
	    		$(".accessCount").html(result);
			}
		}
	})
}
/**
 *  
 * @return
 */
function copyArticle(obj) {
    var info = $(obj).parent(".modal-footer").siblings(".copyCitationInfo").text().trim();
    copyToClipboard(info);
}
function copyArticle2(obj) {
    var info = $(obj).parents("table").siblings(".copyCitationInfo").text().trim();
    copyToClipboard(info,obj);
}
/**
 *  
 * @param info
 * @return
 */
function copyToClipboard(info,obj){
    var oInput = document.createElement('input');
    oInput.value = info;
    document.body.appendChild(oInput);   
    setTimeout(
    	function(){
    		$(oInput).select();  	
    		document.execCommand("Copy");
		    oInput.className = 'oInput';
		    oInput.style.display='none';
			if($(obj).parents("table").siblings(".copyCitationInfo").hasClass("copyCitationInfo-en") || $("#language").val()=="en"){
				alert("copy citation success");
			}else{
				alert("复制成功");
			}
    	},500);
}

/**
 *  
 */
$(function(){
	 
	$(".download-btn").click(function(){
		$("#exportCitationModal").css({"opacity":"1"})
	});
	 
    $(".group2").colorbox({rel:'group2',width:'90%',height:"75%",opacity:'0.8'});
	$(".group3").colorbox({rel:'group3',width:'90%',height:"75%",opacity:'0.8',
    	onComplete:function(){
    		$("#cboxTitle").niceScroll({  
    	        cursorcolor:"transparent",  
    	        cursoropacitymax:1,  
    	        touchbehavior:false,  
    	        cursorwidth:"5px",  
    	        cursorborder:"0",  
    	        cursorborderradius:"5px"  
    	    });
    		 
   			//MathJax.Hub.Queue(["Typeset", MathJax.Hub]);

	}
    });
    $(".group4").colorbox({rel:'group4',width:'90%',height:"75%",opacity:'0.8',inline:true});
 
    var allPath=$("#allSrc").val();
	if($(".article-abstract img,.article-info-en img").length>0){
		$(".article-abstract img,.article-info-en img").each(function(){
			var src=$(this).attr("src");
			$(this).attr({"src":allPath+src});
		})
	}
})
/**
 * 
 * @param type
 * @param q
 * @return
 */
function getRelationship(){
        var url = local_host + "article/getRelationship";
        var myChart = "";
    	$.ajax({
    		type:'post',
    		url:url,
    		data:{'id':$("#articleId").val()},
    		async: false,
    		dataType:'json',
    		success:function(dataMap){
    			var webkitDep = null;
				for(var key in dataMap){
					if(key == "keyword"){
			        	myChart = echarts.init(document.getElementById('keywordEcharts'));
			        }else if(key == "author"){
			        	myChart = echarts.init(document.getElementById('authorEcharts'));
			        }
					/**
					if(key == "keywordCn"){
			        	myChart = echarts.init(document.getElementById('keywordCnEcharts'));
			        }else if(key == "keywordEn"){
			        	myChart = echarts.init(document.getElementById('keywordEnEcharts'));
			        }else if(key == "authorCn"){
			        	myChart = echarts.init(document.getElementById('authorCnEcharts'));
			        }else if(key == "authorEn"){
			        	myChart = echarts.init(document.getElementById('authorEnEcharts'));
			        }
			        */
					webkitDep = dataMap[key];
					myChart.showLoading({
			    		text: "Data loading..."
			        });
					myChart.hideLoading();
	        		var categories = webkitDep.categories;
	        		var categoryArray  = new Array();
	        		$(categories).each(function(i,val) {
	        			categoryArray.push(val.name);
	        		}); 
	        		//alert(sds);
	    	        var option = {
	    	            legend: {
	    	                data: categoryArray 
	    	            },
	    	            series: [{
	    	                type: 'graph',
	    	                layout: 'force',
	    	                animation: false,
	    	                label: {
	    	                    normal: {
	    	                        show:true,
	    	                        position: 'right'
	    	                    }
	    	                },
	    	                draggable: true,
	    	                data: webkitDep.nodes.map(function (node, idx) {
	    	                    node.id = idx;
	    	                    return node;
	    	                }),
	    	                categories: webkitDep.categories,
	    	                force: {
	    	                    edgeLength: 105, 
	    	                    repulsion: 100   
	    	                },
	    	                edges: webkitDep.links
	    	            }]
	    	        };
	    	        myChart.setOption(option);
	                 
	                myChart.on('click', function (param) {
	                	var option = myChart.getOption();
	                    var data = param.data;
	                
	                    if (data != null && data != undefined) {
	                        if (data.url != null && data.url != undefined) {
	                             
	                            window.open(local_host+data.url);
	                        }
	                    }
	                });
				}
        	}
    	})
    }
	
/**
 *  
 */
$(function(){
	var newsId = $("#newsId").val();
	if(!isNull(newsId)){
		var ajaxArg={
				url : local_host +"common/newsBrowseNum",   										
				data : {
					'newsId':newsId
				},  																		
				returnFun:refreshBrowserNum,											
			};
		ajaxPost(ajaxArg);
	}
})
/**
 * 
 * @param data
 * @return
 */
function refreshBrowserNum(data){
	$("#browseNum").text(data.browseNum);
}

/**
 * article_base.js
 *
 */

/**
 *  
 * e：object 
 * */
function toExportCitation(e,pageType){
    var ids = $(e).attr("article_id");
    if(typeof(ids) == "undefined" || ids == null || ids == ""){
        ids = window.articleId;
    }
    var pageType = "";
    if($("#language").val()=="en"){
		pageType = "en";
    }else{
    	pageType = "cn";
    }
    if(ids != ""){
        //alert(ids);
        var type = $("input[name='format']:checked").val();
     
        var content = $("input[name='content']:checked").val();
        filePath=local_host+"article/exportCitation?ids="+ids+"&fileType="+type+"&isAbs="+content+"&pageType="+pageType;
        window.location.href=filePath;
        $(".li_excel_box").hide();
        $(".modal-bg").hide();
    }else{
        if($("#language").val()=="cn"){
            alert("Article information is wrong, please check!");
        }else{
            alert("Article information is wrong, please check!");
        }
    }
}



 
function toExportXML(articleId){
	window.location.href=local_host+"article/exportXML?ids="+articleId+"&downType=XML";
}

/**
 * 
 * @param tableId
 * @param type para : table  
 * @return
 */
function downloadCsv(id,type){
	window.location.href=local_host+"article/exportCsv?id="+id+"&type="+type;
}
 
function nbsp(el) {
    var tableSon=$(el);
    for(var i=0;i<tableSon.length;i++){
        var test=tableSon[i].innerHTML;
        test=test.replace(/&nbsp;/ig, "");
        test=test.replace(/<hr>/ig, "");
        tableSon[i].innerHTML=test;
    }
}
 
function createTableSub(){
	$('.table-body').find('br').remove();
	$('td').find('br').remove();
	$(".table_content table").each(function(i,e){
		var subImg = $(e).parents(".figure").find(".article_table_fullText img");
		//html2Img($(e),subImg);
	})
}
 

function html2Img1(Obj,imgObj, widthW, heightH){
	var htmlContent = $(Obj).prop("outerHTML");
	var data = "data:image/svg+xml," +
	"<svg xmlns='http://www.w3.org/2000/svg' width='"+widthW+"' height='"+heightH+"'>" +
	"<foreignObject width='2000' height='100%'>" +
	"<div xmlns='http://www.w3.org/1999/xhtml' style='font-size:16px;font-family:Helvetica'>" +
	htmlContent +
	"</div>" +
	"</foreignObject>" +
	"</svg>";
	$(imgObj).attr("src",data);
}

function html2Img(Obj,imgObj){
	html2Img1(Obj, imgObj, "210", "179")
}

 
function downloadImg(id,type){
	window.location.href=local_host+"article/exportImg?id="+id+"&type="+type;	
}

/**
 *  
 * @param figName
 * @param articleId
 * @param title
 * @param titleEn
 * @return
 */
function downloadPPT(id,type){
	window.location.href=local_host+"article/exportPPT?id="+id+"&type="+type;	
}

 
function ajaxDownVisitArticleCount() {
	if($("#articleId").length>0){
		$.ajax({
	        type: 'post',
	        url: local_host + 'article/getDownLookCount',
	        data: {'articleId': $("#articleId").val()},
	        success: function (_resultdata) {
	            if (_resultdata != "null") {
	             
	                var _downCount = _resultdata['pdfDownCount'];
	                if (null == _downCount || "" == _downCount) {
	                    _downCount = 0;
	                }
	                 
	                var _viewCount = _resultdata['viewCount'];
	                if (null == _viewCount || "" == _viewCount) {
	                    _viewCount = 0;
	                }
	              
	                var _htmlViewCount = _resultdata['htmlViewCount'];
	                if (null == _htmlViewCount || "" == _htmlViewCount) {
	                    _htmlViewCount = 0;
	                }
	               
	                var _pdfSize = _resultdata['pdfFileSize'];
	                if (null == _pdfSize || "" == _pdfSize) {
	                    _pdfSize = 0;
	                }
	                $("#downloadArticleCount").text(_downCount);
	                $("#visitArticleCount").text(_viewCount);
	                $("#htmlViewCount").text(_htmlViewCount);
	                $("#pdfSize").text(_pdfSize > 0 ? "(" + _pdfSize + "KB)" : "0KB");
	            }
	        }
	    })
	}
}

/**
 *  
 */
function browserRedirect() {
    var sUserAgent = navigator.userAgent.toLowerCase();  
    var bIsIpad = sUserAgent.match(/ipad/i) == "ipad";  
    var bIsIphoneOs = sUserAgent.match(/iphone os/i) == "iphone os";  
    var bIsMidp = sUserAgent.match(/midp/i) == "midp";  
    var bIsUc7 = sUserAgent.match(/rv:1.2.3.4/i) == "rv:1.2.3.4";  
    var bIsUc = sUserAgent.match(/ucweb/i) == "ucweb";  
    var bIsAndroid = sUserAgent.match(/android/i) == "android";  
    var bIsCE = sUserAgent.match(/windows ce/i) == "windows ce";  
    var bIsWM = sUserAgent.match(/windows mobile/i) == "windows mobile";  
 
    if (bIsIpad || bIsIphoneOs || bIsMidp || bIsUc7 || bIsUc || bIsAndroid || bIsCE || bIsWM) {  
    	
    } else {  
    	var val = $('.article-nav li:contains(Full Text(HTML))').attr('articleId');  
    }  
} 
browserRedirect();
/**
 *  
 */
var cacheObj = {
    cache: {},
    set: function (content, id, val) {
        this.cache[content + id] = val
    },
    get: function (content, id, ajaxF) {
        return this.cache[content + id]
    },
    clearCache: function () {
        this.cache = {}
    }
};

/**
 * ajax 
 * @param articleId
 */
var ajaxFigTabNum=0;
function ajaxFigTab(articleId) {
	if(ajaxFigTabNum!=0){
		return;
	}
	ajaxFigTabNum++;
    $.ajax({
        url: local_host + 'article/figTab',
        async: false,
        type: 'get',
        data: {'id': articleId},
        success: function (data) {
            if (!data.access == false) {
            	window.location.href = local_host + 'member/login';
                //alert(data.message);
            } else {
                $('#figTab').html(data)
                $(".group2").colorbox({rel:'group2',width:'90%',height:"75%",opacity:'0.8'});
                 
                setTableImg();
               
                resetHref();
                 
                removeTableBorder();
         
                $("#cboxTitle").niceScroll({  
        	        cursorcolor:"transparent",  
        	        cursoropacitymax:1,  
        	        touchbehavior:false,  
        	        cursorwidth:"5px",  
        	        cursorborder:"0",  
        	        cursorborderradius:"5px"  
        	    });
            }
        }
    });
     
    MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
}
/**
 * 
 */
function loadArticleReleaseProgressAjax(articleId) {
    $.ajax({
        type: 'post',
        url: local_host + 'article/loadArticleReleaseProgressAjax',
        data: {'articleId': $("#articleId").val()},
        success: function (_resultdata) {
        }
    })
}

/**
 *  
 * @return
 */
function loadTableAndFigureCount(){
	var figureCount = $(".article-box.article-box3 ._figclass").length;
	var tableCount = $(".article-box.article-box3 .article_table_fullText").length;
	var figTableNum = "";
	if(figureCount > 0) figTableNum += "figure("+figureCount+")";
	if(tableCount > 0) figTableNum += "table("+tableCount+")";
	$("#fig_table_num").text(figTableNum);
}

/**
 *  
 * @param articleId
 * @return
 */
function loadArticleMetricCount(articleId) {
    //articleVisitMonth(articleId);
    //articleVisitType(articleId);
    //articleVisitArea(articleId);
}


// 
function hideComDrop(){
	var comAuthorWrap=$(".com-author-wrap").text().trim();
	//alert(comAuthorWrap);
	if(comAuthorWrap == ""){
		$(".com-drop").hide();
	}
}
	var currentTab = "abs";     
	//ajaxDownVisitArticleCount();
 
    //createTableSub();
 
    removeTableBorder();
 
 
    resetFormulaSrc();
 
    if($(".com-author-wrap").length>0){
    	hideComDrop();
    }
    currentTab = $('.article-nav ul li.current').attr("rel");
 
	$("sup.authorTag,.article-author,.article-keyword").each(function(i,e){
		var tagText = $(e).text().trim();
		if(tagText.endWith(",")){
			var tagHtml = $(e).html().trim();
			$(e).html(tagHtml.substring(0,tagHtml.length - 1));
		}
	})

 
function resetHref(){
	$(".article-box3 a[ref-type='fig']").each(function(i,e){
		var resetFigHref=$(e).attr("href");
		var resetFigureNum = Number(resetFigHref.substring(7)); 
		//alert(resetfigureNum);
		resetFigHref=$(e).attr({"href":"#Fig-Figure"+resetFigureNum+""});
	})
	$(".article-box3 a[ref-type='table']").each(function(i,e){
		var resetTableHref=$(e).attr("href");
		var resetTableNum = Number(resetTableHref.substring(6));  
		//alert(resetfigureNum);
		resetTableHref=$(e).attr({"href":"#Fig-Table"+resetTableNum+""});
	})
}
/**
 * 调整图表内容中的图片路径
 * @return
 */
function setTableImg(){
	var path = $("#basePath").val();
    $(".table_content .graphic").each(function(i,e){
    	if($(e).attr("src").indexOf(path)===-1){
    		$(e).attr("src",path+$(e).attr("src"));
    	}
	})
}
function resetFormulaSrc(){
	var path = $("#basePath").val();
	$(".formula").each(function(i,e){
		var obj = $(e).find("img");
		if(obj.length==0)return true;
		var src = obj.attr("src");
		if(src.indexOf(path)==-1){
			src = path+src;
		}
		var onerror = src.replace(/.jpg/,".png");
		obj.attr("onerror","this.onerror=null;this.src='"+onerror+"'").attr("src",src);
	})
	$("inline-formula").each(function(i,e){
		var obj = $(e).find("img");
		if(obj.length==0)return true;
		var src = obj.attr("src");
		if(src.indexOf(path)==-1){
			src = path+src.replace(/PIC\//,'');
		}
		var onerror = src.replace(/.jpg/,".png");
		obj.attr("onerror","this.onerror=null;this.src='"+onerror+"'").attr("src",src);
	});
	$("inline-formula").each(function(){
		var num=$(this).find("alternatives .graphic");
		if(num.length>1){
			$(this).find("alternatives .graphic:first").show().siblings().hide();
		}
	});
}

 
function removeTableBorder(){
	var tableImg=$(".table_content table").find("img");
	tableImg.parents(".table_content table").css({"border-bottom":"0"});
}

/**
 *article.js
 * 
 */
$(document).ready(function(){
    createContents();
    if(currentTab == "html" || currentTab == "fig"){
        $(".article_ceil_wrap").find(".article_catalog span").show();
		 
    catalogTree();
    }else{
         $(".article_ceil_wrap").find(".article_catalog span").hide();
    }
	  
	 var str=$('.article-info-title').html(); 
	 if(str=='&nbsp;'){
		 $(".article-info-title").remove();
	 }
 
	$(".article-author span:last,.article-keyword span:last").each(function(i,e){
		var tagText = $(e).text().trim();
		if(tagText.endWith(",")){
			var tagHtml = $(e).html().trim();
			$(e).html(tagHtml.substring(0,tagHtml.length - 1));
		}
	})
  
    $('.article-nav ul li').click(function(){
        currentTab = $(this).attr("rel");
        $(this).addClass('current').siblings().removeClass('current');
         index=$(this).index();
        $('.article-box').eq(index).addClass('current').siblings().removeClass('current');
        createContents();
        if(currentTab == "html"){
       
            //showBigFigTable();
      
	   		MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
     
            $(".group2").colorbox({rel:'group2',width:'90%',height:"75%",opacity:'0.8',
            	onComplete:function(){
	        		$("#cboxTitle").niceScroll({  
	        	        cursorcolor:"transparent",  
	        	        cursoropacitymax:1,  
	        	        touchbehavior:false,  
	        	        cursorwidth:"5px",  
	        	        cursorborder:"0",  
	        	        cursorborderradius:"5px"  
	        	    });
	        	 
	 	   			MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
	    		}
            });
            $(".group3").colorbox({rel:'group3',width:'90%',height:"75%",opacity:'0.8',
            	onComplete:function(){
	        		$("#cboxTitle").niceScroll({  
	        	        cursorcolor:"transparent",  
	        	        cursoropacitymax:1,  
	        	        touchbehavior:false,  
	        	        cursorwidth:"5px",  
	        	        cursorborder:"0",  
	        	        cursorborderradius:"5px"  
	        	    });
	         
	 	   			MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
	    		}
            });
            $(".group4").colorbox({rel:'group4',width:'90%',height:"75%",opacity:'0.8',inline:true,
            	onComplete:function(){
	        		removeTableBorder();
	        		$("#cboxTitle").niceScroll({  
	        	        cursorcolor:"transparent",  
	        	        cursoropacitymax:1,  
	        	        touchbehavior:false,  
	        	        cursorwidth:"5px",  
	        	        cursorborder:"0",  
	        	        cursorborderradius:"5px"  
	        	    });
	        		 
	 	   			MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
	    		}
            });
        }
        if(currentTab == "html" || currentTab == "fig"){
            catalogTree();
            $(".article_ceil_wrap").find(".article_catalog span").show();
        }else{
             $(".article_ceil_wrap").find(".article_catalog span").hide();
        }
    })
   
    $(".addScroll").niceScroll({  
        cursorcolor:"transparent",  
        cursoropacitymax:1,  
        touchbehavior:false,  
        cursorwidth:"5px",  
        cursorborder:"0",  
        cursorborderradius:"5px"  
    });

 
    $(".article-authors ul li span").click(function(){
        $(this).parent().toggleClass('current').siblings().removeClass('current');      
    });
 
    $('.article_catalog').mouseover(function(){
        //$('.article_ceil_list').css({"height":"310px"});
        $('.article_ceil_list').stop().show();
    }).mouseout(function(){
        $('.article_ceil_list').stop().hide();
    })

 
    $(document).on("click",".article_ceil_list li a",function(){
        var articleceilaid=$(this).attr('ref');
        $('.ceilfirst li').removeClass('active');
        $(this).parent().addClass('active');
        $("html,body").animate({
           scrollTop: $(articleceilaid).offset().top-72 + "px"
        }, {
          duration: 500,
          easing: "swing"
        });
        $('.article_ceil_list').stop().hide();
    })
 
     var refBoxHidetimer;
     var divShowHeight = $(".div_show").height();

	    $(document).on("click",".figure .div_btn",function(){
	        $(this).parents(".figure").toggleClass('showBtn').siblings(".figure").removeClass('showBtn');      
	    });
	});

 
function showAuthor(obj){
    var openStatus =$(obj).hasClass("current");
    //alert(openStatus);
    if(openStatus){
        $(obj).removeClass("current");
        $(obj).parent(".article-author").siblings(".com-author-wrap").stop().slideUp();
    }else{
        $(obj).addClass("current");
        $(obj).parent(".article-author").siblings(".com-author-wrap").stop().slideDown();
    }
}

 
function createContents(){
    //alert(currentTab);
    $(window).scroll(function(){
        var articlescrolltop=$(document).scrollTop();
        if(articlescrolltop>=600){
            $(".article_ceil_wrap").show();
            //$(".article-bomb-box-wrap").show();
            //$(".article-box-wrap").hide();
        }else{
            $(".article_ceil_wrap").hide();
            //$(".article-bomb-box-wrap").hide();
            //$(".article-box-wrap").show();
        } 
        $('.article_ceil_list').stop().hide();
    })
}

/**
 *  
 * @return
 */
function catalogTree(){
    $(".ceilfirst").empty();
    $(".figureCeilUl").empty();
    $(".tableCeilUl").empty();
    if(currentTab == "html"){
        var html = "";
        $(".article-box span.sec-title").each(function(i,e){
            var level = $(e).attr("level");
            var href = $(e).attr("id");
            var title = $(e).text();
            html += '<li class="sec_'+level+'"><a ref="#'+href+'" href="#'+href+'">'+title+'</a></li>';
        })
        $(".ceilfirst").empty().append(html);
        var figureHtml="";
        var tableHtml="";
        $(".ceilfirst").css({"border-bottom":"1px solid #ccc"});
        $(".article-box2 .figure .figure_title a img").each(function(i,e){
            var figureHref=$(e).attr("id");
            //alert(figureHref);
            var figureNum = Number(figureHref.substring(6));  
            //alert(figureNum);
            //var figureTitle=$(e).find(".figure_caption p").eq(0).text();
            figureHtml += '<li class="figureShow"><i></i><a href="#Figure'+figureNum+'" ref="#Figure'+figureNum+'">图'+figureNum+'&nbsp;(Figure'+figureNum+')</a></li>';
        })
        $(".figureCeilUl").empty().append(figureHtml);

        $(".article-box2 .figure .article_table_fullText>a").each(function(i,e){
            var tableHref=$(e).attr("id");
            //alert(tableHref);
            var tableNum = Number(tableHref.substring(5));  
            //var tableTitle=$(e).find(".table_caption p").eq(0).text();
            tableHtml += '<li class="tableShow"><i></i><a href="#Table'+tableNum+'" ref="#Table'+tableNum+'">表'+tableNum+'&nbsp;(Table'+tableNum+')</a></li>';
        })
        $(".tableCeilUl").empty().append(tableHtml);

    }else{
        var figureHtml="";
        var tableHtml="";
        $(".ceilfirst").css({"border-bottom":"none"});
        $(".article-box3 .figure .figureTextBox a img").each(function(i,e){
            var figureHref=$(e).attr("id");
            var figureNum = Number(figureHref.substring(10));  
            //alert(figureNum);
            //var figureTitle=$(e).find(".figure_caption p").eq(0).text();
            figureHtml += '<li class="figureShow"><i></i><a href="#Fig-Figure'+figureNum+'" ref="#Fig-Figure'+figureNum+'">Figure'+figureNum+'</a></li>';
        })
        $(".figureCeilUl").empty().append(figureHtml);

        $(".article-box3 .figure .article_table_fullText").each(function(i,e){
            var tableHref=$(e).attr("id");
            var tableNum = Number(tableHref.substring(9));  
            //var tableTitle=$(e).find(".table_caption p").eq(0).text();
            tableHtml += '<li class="tableShow"><i></i><a href="#Fig-Table'+tableNum+'" ref="#Fig-Table'+tableNum+'">Table'+tableNum+'</a></li>';
        })
        $(".tableCeilUl").empty().append(tableHtml);

    } 
    if(figureHtml==""&&tableHtml==""){
    	$(".figureCeil h4").css({"display":"none"});
    }
}

 
function showBigFigTable(){
	$(".article-box2 .xref a[ref-type='fig']").each(function(i,e){
		var figHref=$(e).attr("href");
		$(e).addClass("group3 cboxElement");
		//alert(figHref);
		var resetFigHref=$(figHref).parent("a").attr("href");
		var resetFigTitle=$(figHref).parent("a").attr("title");
		//alert(resetFigHref);
		$(e).attr("href",resetFigHref);
		$(e).attr("title",resetFigTitle);
	})
	$(".article-box2 .xref a[ref-type='table']").each(function(i,e){
		var tableHref=$(e).attr("href");
		$(e).addClass("group4 cboxElement");
		//alert(tableHref);
		var resetTableHref=$(tableHref).attr("href");
		var resetTableTitle=$(tableHref).attr("title");
		//alert(resetFigHref);
		$(e).attr("href",resetTableHref);
		$(e).attr("title",resetTableTitle);
	})
}

/**
 *  
 * @return
 */
function loadArticleCitedByIds(){
	var idArray = [] ;
	$(".article-list").each(function(i,e){
		var articleId = $(e).attr("id");
		if(!isNull(articleId)){
			idArray.push(articleId);
		}
	})
	
	if(idArray.length > 0){
		var ids = idArray.toString();
		var ajaxArg={
			url: local_host +"article/getArticleCitedBy",
			data: {'articleIds':ids},
			returnFun:outArticleCitedByInfo
		};
		ajaxPost(ajaxArg);
	}
}

/**
 *  
 * @param data
 * @param indexArray
 * @return
 */
function outArticleCitedByInfo(data){
	if(typeof(data) != "undefined"){
		data = jQuery.parseJSON(data);
		$.each(data,function(i,e){
			if(e.citedCount > 0){
				$("#"+e.articleId).find(".citedby-font").show();
				$("#"+e.articleId).find(".citedBy-num").html(e.citedCount);
			}
		})
	}
}

/**
 *  
 */
function getVisitInfo(id,viewType){
	var pageType = $("#language").val();
	if(!isNull(pageType)){
		$.ajax({
    		type:'post',
    		url:local_host +"article/getVisitRecord",
    		data:{'id':id,
				'viewType':viewType,
				'pageType':pageType},
    		success:function(dataMap){
    		}
		})
	}
}

/**
 *  
 */
function switchFormula(){
	 var formulatext = $(".switchFormula").text();
	 if(formulatext.indexOf('off')>1){
		 $(".switchFormula").text(formulatext.replace('off', 'on'));
 
		 $(".formula tbody tr td p").hide();
		 $(".formula-labelText").hide();
		 $(".formula tbody tr td.formulaTag").hide();
		 $(".formula tbody tr td p.img-formula").show();
 
		 $(".inline-formula-span").hide();
		 $(".inline-formula-span").next().show();
	 }else{
		 $(".switchFormula").text(formulatext.replace('on', 'off'));
	 
		 $(".formula tbody tr td p").show();
		 $(".formula-labelText").show();
		 $(".formula tbody tr td.formulaTag").show();
		 $(".formula tbody tr td p.img-formula").hide();
 
		 $(".inline-formula-span").show();
		 $(".inline-formula-span").next().hide();
	 }
}

/**
 *  
 */
function addNewsRecords(){
	var newsId = $("#newsId").val();
	if(!isNull(newsId)){
		$.ajax({
    		type:'post',
    		url:local_host +"getVisitNewsRecord",
    		data:{'id':newsId},
    		success:function(dataMap){
    		}
		})
	}

}

